---
title: 无用之技 —— NAS
date: 2017-04-15
description: 自年前出于兴趣着手研习至今，已有两三月
---

## 前言

---

自年前出于兴趣着手研习至今，已有两三月。成果虽是有，却或多或少去想自身是否又学到一技无用。

该文更多是捋顺了一遍思路及其操作过程，其中附加一些阐述、思辩及理解，其中对于 _NAS_ 的搭建及网路的配置并未详细书写。

这是一篇枯燥之文。<!--more-->

- **提笔为此：**
  - 记录并分享年前至今所学所为之成果
  - 思维及文字的组织练习
  - 尝试 _markdown_ 语言进行书写

## 起

---

> 为什么选用固态硬盘？

我自大学时期换至第二个超极本，为追求速度，亦因价格昂贵，且存储需求并不强劲，故一直使用小容量 SSD（即 **S**olid **S**tate **D**rives 固态硬盘）。
_250 GB_ 的存储大小可能对于很多同学来说是觉得不可思议，诚然，在我们这一辈人进入大学时，_500 GB_ 就已经是标准配置，更不必言我先前的本子使用的 SSD _120 GB_ 大小看起来有多么捉襟见肘。

先说现状

- **如下**

  - **PC**

    - 256 GB SSD（Windows）

    - 250 GB SSD（OS X）

  - **Ultra Book**

    - 250 GB SSD（OS X）

以上是我现今使用的两台电脑的存储情况。
之所以选择固态硬盘，前面也已经提到了，是速度。这里不谈深圳的一些山寨品牌，就国际上几家大厂的产品来说，从测试数据来看固态硬盘的整体速度平均在机械硬盘的 **三倍及以上** ，更不用提现在逐渐铺货的新接口（M.2 接口）固态硬盘，速度更是 **十几倍以上** 。
那么，硬盘的速度对于电脑来说究竟意味着什么？
就我个人的理解，电脑作为一个完整的系统，其下的硬件都有明确分工。这里只挑存储，处理器部分来聊。
打个比方，我们做作业。
硬盘可以看作是题本，上面写满了密麻的问题，这些问题即是存储在各式各样得题本上的。而我们面对问题时是需要去解决的，要解决问题毫无疑问需要计算，不论计算所得的是对的，错的，或是无解，它们同属于结果的范畴。

**这个过程于我们而言，简化后，在忽略问题复杂度下，是：**

1. 老师发下来一个题本要求同学得出答案（结果）
2. 题本上有需要解决的问题
3. 同学经由眼睛输入给大脑
4. 大脑进行计算
5. 同学用手书写出答案（返回结果，结果是问题的答案）

**相对的，在计算机中：**

1. 用户下达指令要求一个结果（诸如打开一个游戏）
2. 游戏代码存储在硬盘中（即问题，软件的运行需要计算）
3. 经由总线输入给 CPU（忽略内存读取过程，CPU 内部传输）
4. CPU 进行计算
5. 输出结果至显示设备（返回结果，结果是游戏开始运行）

然而不同的是，CPU 因为是机械，所以单纯的计算速度是远高于人脑效率。**我们人用肉眼输入的问题的信息量及效率是远远不能够满足电脑的计算效率，当输入的数据量不足以支撑计算所需的条件时，CPU 就得等待到数据量足够才能进行计算。而电脑中代码经由硬盘输入，若是硬盘的速度不够快，这就造成了 CPU 得等待从硬盘读取的数据，而等待的过程中，CPU 是不能够进行计算的。**

**就好似如果一道应用题的所有条件没有了解到时是无法得出结果的，而此时你唯一能做的只是把条件都好好读完。**

综上，可以得知硬盘速度对于电脑整个系统运行速度的影响。

即硬盘速度越快，电脑的效率就越高。从开机时间至打开关闭保存，无不相关。

固态硬盘与传统机械硬盘的区别在于，固态硬盘使用闪存颗粒进行存储，机械硬盘则使用磁碟来存储。粗略理解，磁碟转速再如何的快也不能及一股电流通过线路的速度。

## 承

---

> 问题

起因是选择了速度更快的固态硬盘，基于价格考虑，所以相应的缩减了硬盘容量，然而，硬盘容量这个指标于我们使用者来说，是否是一个影响比较大的因素？

这需要综合来看。
实际上电脑以及互联网的发展可以看作是一个鳞次栉比的过程。
需求在不断的提高，技术也在不断的跟进，但，我以为，它们之间总会出现错位的时分。即是总有技术跟不上需求/需求跟不上技术的时刻，当然，很快它们就会出现重叠，然后再经由新需求，再生成新技术，长此以往。

依稀记得在很小的时候，那个时代软盘这种东西还是主流的存储介质。一个*3.5 寸*大小的软盘双面容量综合为 _1.44MB（1GB=1024MB）_ 。那个年代互联网远未普及，游戏因为容量的需求较大，所以常能看到游戏软盘可能会有两块甚至更多，且游玩过程中当一个软盘一面里的/软盘里的内容完了，需要你取出软盘，翻个面，或者喂进第二块软盘才能继续游戏。
那个年代，不论电脑运行的系统，还是你存储的资料。统统都装在这些五颜六色的软盘里，想想还真是可爱。人们照样乐此不疲的使用着。
真是远古的时代，让我忆起了还在读幼儿园的自己。

现在可能很难想象一块 _3.5 英寸_ 的硬盘（台式机一般使用*3.5 英寸*硬盘，笔记本使用*2.5 英寸*硬盘），这样一个庞然大物容量竟只有*1GB*。是的。在 91 年我出生那一年，第一个*3.5 英寸*容量 1GB 的硬盘刚由 IBM 推出。

再看看现在，某宝上能搜到的 _60GB_ 硬盘也不知是哪般年代的洋垃圾。目前 _500GB_ 仍然是标配。更高的跨度可以从 _1TB_ 至 _8TB_ 甚至更多。

产品的出现始终是由需求来决定。
显然，对于更高的存储容量，需求始终存在。

更多的容量对应更高的需求。
然而，作为一般使用着来说，我们是否真的需要更多的容量呢？

这个问题的答案不是固定的，但是既然是限定了在了一般使用者，那答案也是存在一定范围内的。
一般消费者也是分有很多层次，而不同层次对应的需求是不一样的。而你的需要是根据你的需求来定的。所以有了一个最宽泛的答案，即——合适。

日常上上网看看新闻，电影，听点音乐，偶尔玩点流行的网络游戏，处理一些工作上的文档，码码字做做编辑。 _120GB_ 也是能算进去的，进阶一些，若是会管理的话 _120GB_ 亦是可以做到绰绰有余。
另一方面现今网络发展程度比较成熟了，已不像许多年前 _100KB/s_ 的下载速度也觉得很快啊的情况。实际上网络可以看作是电脑的一个全球共享的超级大硬盘，以前的网络的传输速度无法满足仅通过一根网线就能看到比较高清的视频。所以更多是采取下载下来的方式观看，而这就需要不少硬盘容量，如果搜集的多一些，吃紧是很常见的。可现今不同，一根网线，就可以做到观看满足一般消费者的影音节目。所以也不需要弄那么大了，使用是完全没问题。当然，玩游戏你还是得下载，可现在的人，玩的游戏多是网络游戏，且多是固定在那么一两款上。所以也是可以满足的。

而作为一些影音工作者，设计从业者以及特殊行业和发烧级别的玩家来说。这点可怜的容量是远远不够的。

不论是存放一些素材，还是存储极清电影，无损音乐，游戏等。或者有特殊搜集癖想要装多一些小姐姐(?)，都是无法满足需求的。

这中间就出现了一个矛盾。既想拥有本地设备的高运行速度，又想拥有海量的存储容量。显然，购买海量或高容量的 SSD 是不现实的，何况最近这一块的产品价格还在疯长。而大存储又无法兼顾速度。

这就提出来了一个问题。

## 转

---

> 问题需要被解决

是的，作为一个可能的设计从业者，游戏爱好者，对于生活品质有追求（废话，每个人都有这个追求！）的我来说，不论是自己平常练习所留下的源文件，还是
自网络搜集的各种素材，以及想要保存下喜爱的游戏，影音等等等等。无一不在哭诉着它们的需求。但之前还好，我尽量不保存它们，基本都是用完即删，彼时还未曾觉得不够用。而真正感觉到捉襟见肘的时候是一次用 _sketch_ 做设计时因为打开了自动保存以至于到后来缓存文件占据了硬盘的大部江山，直到电脑告诉我『小伙子，你的硬盘已经满了』。
虽然靠删除就解决掉该问题，但反思一番，我才发觉我需要更多的容量。

- **究其原因有（不限于）以下：**

  - 随着时间推移，存储需求会因为练习次数越来越大

  - 喜爱的电影，音乐甚至游戏等，我都希望存在本地作为收藏随手可得

  - 因为是使用非苹果的设备安装 _Hackintosh_，且工作性质对于备份有需求 ，所以希望能用到苹果的 Time Machine 备份

  - 素材若是存在本地就可以节省去每次用到时去查去下载的时间

既保证电脑运行速度，又保证海量存储。
我挑出了在脑子里想了很长时间的方案。

**NAS（*N*etwork *A*ttached *S*torage 网络附属存储）**

简单来讲，就是一个通过网线进行读取的存储设备。
先从存储说起，NAS 是一个独立的系统，唯一任务就是存储。只要有需求，你就可以简单的像复制甚至打开本地硬盘的文件一般从 NAS 服务器读取。
狭义的——可以看作放在角落只连着网线电线且通过网络使用的一台装有大容量硬盘的电脑。
广义的——一台服务器，通过网络，你可以使用任何设备在家里访问，在路上访问，在工作地点访问。当然从家庭网络以外访问需要有强大带宽支撑。

市面上有成熟的方案出售，估计听得最多的就是 _Synology（群晖）_ ，因为该公司提供的方案对于普通人讲易用性很高，所以被人提及特别多。当然还有一些小厂商也在做，只是成熟度不及前者。这些是成品方案。

而我选择 _DIY_ 。
为什么？因为成品方案的价格，多多少少还是挺能引起注意的。虽然方便，买来插上电就可以用了。可我有个隐性的需求是**好玩（zhe teng）** 。 _DIY_ 的更低成本及更高可玩性、扩展性都是相当具有诱惑力，可以说为今后带了无限可能，因为一切都是自己可以掌控的。当然，相应的要付出时间作为代价来弥补它们之间的差价。

- **关于 _NAS_ 系统的选择，其实很多。以下罗列出一些我在探索过程中认为可用性相对较高的部分 _NAS_ 系统：**

    1. **DSM**
    （群晖官方系统，在非官方硬件跑 DSM 称作 黑群辉 ） 
    2. **FreeNAS**
  （基于 Freebsd 系统的开源 NAS 系统，功能强，界面设计挺帅，但硬件要求高） 
  3. **Openmediavault**
  （字义为开源媒体仓库，由原 FreeNAS 核心成员 Volker Theile 发起的基于 Debian 系统开发的开源 NAS，主要面向家庭及小型办公环境） 
  4. **EasyNAS**
  （相对年轻的 NAS 系统，因为年轻，大概目前还不够成熟）

我从以上中选择了 _OMV_ ，因为其对于 _树莓派_ 这种基于 _ARM_ 架构的设备有良好支持。

硬件的选择，手上刚好有一块除了跑 Finalspeed 客户端 和 Minecraft 服务器 就吃灰两年的 _树莓派_ ，就它了！

那什么是 _树莓派_ ?

以下摘自百科

> _Raspberry Pi(中文名为“树莓派”,简写为 RPi，(或者 RasPi / RPI) 是为学习计算机编程教育而设计，只有信用卡大小的微型电脑，其系统基于 Linux。_

_Linux_ 系统几乎主宰服务器领域已经不知道多少年了，所以其稳定性有目共睹。特别要提的是功耗，_NAS_ 作为一台 24*7 的服务器，如果功耗比较大即意味着电表会转的更快，恰好 *树莓派* 基于 *ARM* 架构的硬件使得其功耗如果作为 *NAS\* 服务器来说甚是喜人。更不必言其价格，每一代几乎都稳定在 200 出头。

但有个问题是 _树莓派_ 作为开源硬件，其设计之初是面向教育领域的，所以其 _I/O_ 性能也只能以『够用』来形容。数据显示，其网口与 USB 接口是共享带宽的且纸面带宽也就 _100Mbps_ ，即换算后，能达到 _10MB/s_ 的传输速度。这对于现在 PC 广泛使用的 _SATA3_ 接口的 _6Gbps_ 带宽简直是小巫见大巫。
一开始基于带宽考虑，我也寻找过替代 _树莓派_ 的方案。但除它以外的硬件纵是有代 _SATA_ 接口的怪物，但终是因为其社区支持不够望而却步。

对于想要使用开源硬/件软件来说。社区支持够不够好私以为是衡量这个东西是否可取的非常重要标准之一。
拥有活跃的社区支持的开源硬/软件意味着当你碰到某个问题时可以有来自全球的该社区的开发者/用户帮助你解决。

但之前已经提到过 **合适** 才是对的。
那么在*成本*已经合适的情况下 _100Mbps_ 的带宽是否够用呢？

所以在动手完成供自己使用的低成本 _NAS_ 前，作为预演及测试，我利用已有的一块 _树莓派_ 为家父搭建了第一个 _NAS_ 以期其作为家庭媒体中心。

OMV 的安装很简单，从官网下载镜像再根据文档提示利用软件烧录（让我想起了大学时期跑宿舍楼下电脑维修店买白光盘烧录 Windows）进 SD 卡即可。插入 _树莓派_ 开机即可完成。
开机后只出现 _命令行界面_ 也不必慌张其是否出了问题，因为它本就只有 _命令行界面_ ，没有 _图形界面_ 。因为 _NAS_ 的目的单一——网络附属存储。所以存储的操作也是由其他设备通过网络完成的。
应该说所有的 _NAS_ 系统都是基于 _web_ 来进行管理，可以避免不必要的性能开销。启动完成后都可以籍由界面上提供的 _IP 地址_ 及相应端口进行访问。就是打开一个网页这般简单，在浏览器就可以对 _NAS_ 的各种功能进行管理了。当然，执意使用命令行也没有问题，前提是你得懂。

- **为家父搭建的 _NAS_ 所用软硬件及成本有：**

  - **硬件**

    - 树莓派（Raspberry Pi）2 代 B 型
      （225 元）
    - 1 TB 2.5 英寸 机械硬盘
      （365 元）
    - 2.5 英寸 硬盘盒
      （30 元）

  - **软件**

    - OMV（*O*pen*m*edia*v*ault 基于 Debian 开源的 _NAS_ 系统）
      （成本 0 元+时间数天）

  - **总成本** 620 元 + 时间数天

这几样就能完成一个简单的 _NAS_ 了。客户端基于 _KODI_ ，籍由 _路由器_ 中转，就完成了一个所有设备都能访问的家庭多媒体中心。
_Windows_，_OS X_，_Linux_ 等主流平台支持的共享协议都是可以简单的在 _web_ 界面进行管理。

在这里，不得不提 **路由器** 在其间的重要性。
_路由器_ 作为家庭网络的网关，管理着各种设备的 _IP 地址_ 分配，流量流向等，所有的与网络相关的信息都经由这里汇集/发送。可以说是家庭网络的核心。所以，性能低下的 _路由器_ 在流量异常凶猛（即使是局域网内传输）或设备繁多的情况下是处理不过来的。就会出现各种网络拥堵，通俗讲就是卡，没反应。除非你的使用目的单一，看电影就只看电影，上网就只上网，玩游戏就只玩游戏。

所以，若选择要使用 _NAS_ 之类，在运行时流量传输强劲的家伙同时不对其他的网络操作造成影响，建议准备一个相对 **强大的路由器** 对网络支撑。
全千兆网口私以为是最低配置了。

经测试 _树莓派_ 的带宽，在复制相对连续的文件时候速度基本能稳定到 _11.2MB/s_ ，这就是满载的情况了，比纸面数据略好一点。
速度对于要求高响应的文件存取肯定不够，可于单纯播放 _1080P_ 的片子是没有问题，更甚， _4K_ 的一般码率的影片经测试也是没有问题。如果视频压缩码率太高的，我估计是行不通了。但除开 _高清爱好者们_ 就现今家用设备的整体情况考虑。 _树莓派_ 作为 _NAS_ 服务器是完全能够胜任的。

所以在年前拿回去后，现在父亲家里不论是 **投影仪** ，**电视盒子** ，**电脑** ，**手机** 都能通过局域网访问到 _NAS_ 中的影视资源。想必我搜集了接近 1T 的诸多资源 **（当然不是手撕鬼子啊！）** ，相信家父在一年内都消化不完。

家中使用的路由器是 0 元撸来的 _斐讯 K2_，_100Mbps_ Lan 口。虽说满载时时其他设备上网会受影响，可对于看电视就只看电视的老爸来说，没有任何问题。

可以说，刚好 _合适_ 。

以上经过了我的诸多测试，且我个人更多的是存储需求并不需要兼顾高速传输。最终敲定以类似方案完成自用的低成本低功耗 _NAS_ 。

- **自用 _NAS_ 所用软硬件及成本及路由器成本有：**

  - **硬件**
    - 路由器 华硕 AC68U
      （500 元）
    - 树莓派（Raspberry Pi）3 代 B 型
      （230 元）
    - 3 TB 3.5 英寸 机械硬盘
      （635 元）
    - 3.5 英寸 硬盘盒
      （60 元）
  - **软件**

    - OMV（*O*pen*m*edia*v*ault 基于 Debian 开源的 _NAS_ 系统）
      （成本 0 元+时间数天）

  - **总成本** 1425 元 + 轻车熟路的时间数天

- **实现的服务有:**

  - **NAS**
    （解决存储需求）

  - **下载机**
    （籍由树莓派完成下载任务到 NAS 硬盘，内网穿透后可远程添加下载任务）

  - **迅雷远程下载**
    （籍由迅雷远程下载客户端 xware，其实也算到下载机里啦，不过国内这些个仓库的种子用 Transmission 根本下不动！）

  - **Kcptun 客户端**
    （用于加速路由器上运行的 『不可描述』）

  - **多媒体中心**
    （籍由 Kodi 作为客户端，备选可用 Plex，但这个需要购买授权）

  - **私有云网盘**
    （基于 Nextcloud ，已绑定域名，可在任何有网络的地方访问，可同步）

  - **时间机器备份**
    （同苹果时间胶囊功能，用于备份 OS X 系统）

  - **Web 服务器及数据库**
    （私有云其实就基于这个了，端口原因没跑别的了）

  - **Docker 容器**
    （当前未发现有适合我的好玩的 Docker 镜像）

  - 哎呀我实在是想不起还有什么了！

  ...

## 结

---

> 啊？我都写了些什么？！

基本上，现阶段的这个问题就这样解决了，电脑上就只专注于当下要完成的东西以确保工作时候的高速响应。而 _NAS_ 则作为存储、备份的一片栖息地外加可以在任何有网络的地方访问的私有云，方便工作上的一些同步。同时满足了固态硬盘带来的电脑的快速度及廉价海量存储的需求还额外附带了一些赠品。

**当然这里只是一个开始。**

因受限于成本，所以选择了这样的软硬件。但说实话这一套就我自己而言是满意的，为什么？因为它 _合适_ ，刚好解决了自己当下的需求，不论是金钱上还是使用上，不多，也不少，刚刚好。同时，若是有个家什么的，多媒体中心也能带来很好的体验。

写到这里我已经老眼昏花了，说真的，在这么两三个月的过程中，因为阅读大量文献文档及帖子，可以说 80%以上都是英文的。也不知道是因为新本子的屏幕太小而让字显得小看起来难受还是说自己没有习惯这些密密麻麻的字母。总之是觉得最近的视力肯定有下降，时有觉得看着模糊的时候，真是难受。

**看来得考虑去医院做个检查，但是没人陪我去啊！我害羞！**

相应的，得益于这阵子的大量阅读，还是可以感受到英文的阅读能力有不小提升，同时还学到了不少有关但不限于 _Linux_ _文件系统_ _路由器_ _网络_ 的新知识。且新添置的路由器，以后不论辗转何处都可以带着它。插上就部署完毕。毕竟现在我都不在电脑上跑代理软件了。全靠 _树莓派_ 和 _路由器_ 的配合来完成这件事。设备连上路由即在不经意间完成了那些 _『不可描述』_ 的工作。

_Markdown_ 用来书写确实很好用，对于文章的规范和可读性都提供了不小的帮助。就决定是你了！说不定这篇文字的组织形式会成为今后的模板之一。

这大概是我第一次写这么多字吧。8500 字！哭！

估计这种枯燥的又臭又长的文章不会有几个人看的吧。因为我写都写得想吐了还觉得写出了一堆废物。更可气的是这些废物花费了我至少 10 小时来完成！懒得校对了。

反正作为一个可能会成为设计师的我来说，已经拥有够多 _（看似）_ 无用的技能了，这次也只是多了一些而已，没什么好嫌弃的。
